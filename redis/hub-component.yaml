---
version: 1
kind: component
meta:
  name: redis
  brief: Redis in-memory data structure store
  source:
      dir: ../../components/linkerd

requires:
  - kubernetes
  - helm
  - tiller

parameters:
  - name: dns.domain
    env: DOMAIN_NAME
  - name: component.redis
    parameters:
    - name: volume.enabled
      brief: true if persistence enabled
      default: "true"
    - name: volume.storageClass
      default: "ebs-gp2"
    - name: volume.size
      default: 8Gi
    - name: usePassword
      default: "false"
    - name: password
      default: " "
    - name: namespace
      env: NAMESPACE
      default: redis
    - name: name
      env: COMPONENT_NAME
      default: redis
    - name: image
      default: bitnami/redis:4.0.2-r1
    - name: requests.memory
      default: 256Mi
    - name: requests.cpu
      default: 100m
    - name: ha
      parameters:
      - name: enabled
        default: "false"
        env: HA_ENABLED
      - name: image
        default: gcr.io/google_containers/redis:v1
      - name: master
        default: 1
      - name: slave
        default: 1
      - name: sentinel
        default: 3
      - name: master.requests.memory
        default: 200Mi
      - name: master.requests.cpu
        default: 100m
      - name: master.limits.memory
        default: 700Mi
      - name: slave.requests.memory
        default: 200Mi
      - name: slave.requests.cpu
        default: 100m
      - name: slave.limits.memory
        default: 200Mi
      - name: sentinel.requests.memory
        default: 200Mi
      - name: sentinel.requests.cpu
        default: 100m
      - name: sentinel.limits.memory
        default: 200Mi

outputs:
  - name: component.redis.host
    value: ${component.redis.name}-redis.${component.redis.namespace}.svc.cluster.local
  - name: component.redis.port
    value: "6379"
  - name: component.redis.url
    value: redis://${component.redis.name}-redis.${component.redis.namespace}.svc.cluster.local:6379
  - name: component.redis.password
    fromTfVar: password

templates:
  files:
    - "*.template"
