---
version: 1
kind: component
meta:
  name: gitlab
  brief: gitlab
  source:
      dir: ../../components/gitlab

provides:
  - gitlab

parameters:
  - name: component.ingress.fqdn
  - name: component.ingress.ssoUrlPrefix
  - name: component.ingress.protocol
  - name: kubernetes.oidc_issuer_fqdn
  - name: dns.domain
    env: DOMAIN_NAME
  - name: component.postgresql
    parameters:
    - name: database
    - name: user
    - name: password
    - name: url
  - name: component.gitlab
    parameters:
    - name: sub
    - name: saml.id
      default: saml
    - name: saml.name
      default: "Gitlab Okta App"
    - name: saml.usernameAttr
      default: name
    - name: saml.emailAttr
      default: email
    - name: saml.groupsAttr
      default: groups
    - name: okta.baseURL
      kind: user
    - name: okta.apiKey
      kind: user
    - name: okta.groups
      default: ASI.Admin
    - name:    name
      default: gitlab
      env:     COMPONENT_NAME
    - name:    namespace
      default: gitlab
      env:     NAMESPACE
    - name:    gitUrlPrefix
      default: git
    - name:    dbHost
      default: ""
    - name:    dbName
      default: gitlab
    - name:    dbNser
      default: gitlab
    - name:    dbPassword
      default: gitlabsekret
    - name:    database
      default: gitlab
    - name:    volume
      default: 8Gi
    - name:    port
      default: 80

outputs:
- name: component.gitlab.git_fqdn
  brief: FQDN of ingress
  fromTfVar: git_fqdn

templates:
  files:
    - "*.yaml.template"
  extra:
  - kind: mustache
    files: ["*.sh.template"]
