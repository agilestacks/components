---
version: 1
kind: component
meta:
  name: gitlab
  brief: gitlab
  source:
      dir: ../../components/gitlab

provides:
  - gitlab

parameters:
  - name: component.ingress.fqdn
  - name: component.ingress.ssoUrlPrefix
  - name: component.ingress.protocol
  - name: kubernetes.oidc_issuer_fqdn
  - name: dns.domain
    env: DOMAIN_NAME
  - name: component.postgresql
    parameters:
    - name: database
    - name: user
    - name: password
    - name: url
  - name: component.gitlab
    parameters:
    - name: acm_certificate.arn
      env: ACM_CERTIFICATE_ARN
    - name:    name
      default: gitlab
      env:     COMPONENT_NAME
    - name:    namespace
      default: gitlab
      env:     NAMESPACE
    - name:    dbName
      default: gitlab
    - name:    dbUser
      default: gitlab
    - name:    dbPassword
      default: gitlabsekret
    - name:    database
      default: gitlab
    - name:    volume
      default: 8Gi
    - name:    port
      default: 80

outputs:
- name: component.gitlab.git_fqdn
  brief: FQDN of ingress
  fromTfVar: git_fqdn

templates:
  files:
    - "*.yaml.template"
  extra:
  - kind: mustache
    files: ["*.sh.template"]
