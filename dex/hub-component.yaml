---
version: 1
kind: component
meta:
  name: dex
  brief: Dex OIDC and OAuth2 provider
  source:
      dir: ../../components/dex

parameters:
  - name: component.ingress.fqdn
  - name: kubernetes.oidc_issuer_fqdn
    kind: user
    env: OIDC_ISSUER_FQDN
  - name: component.dex.namespace
    brief: Kubernetes namespace to install into
    default: dex
    env: NAMESPACE
  - name: component.dex.image
    default: quay.io/coreos/dex:v2.6.0
  - name: component.dex.saml.id
    default: saml
  - name: component.dex.saml.name
    default: "Okta with SAML"
  - name: component.dex.saml.ssoUrl
    default: https://dev-458481.oktapreview.com/app/agilestacksdev458481_dexsaml_2/exkbnioau4uOputKU0h7/sso/saml
  - name: component.dex.saml.caData
    default: LS0tLS1CRUdJTiBDRVJUSUZJQ0FURS0tLS0tCk1JSURwRENDQW95Z0F3SUJBZ0lHQVZ5cUNSRHNNQTBHQ1NxR1NJYjNEUUVCQ3dVQU1JR1NNUXN3Q1FZRFZRUUdFd0pWVXpFVE1CRUcNCkExVUVDQXdLUTJGc2FXWnZjbTVwWVRFV01CUUdBMVVFQnd3TlUyRnVJRVp5WVc1amFYTmpiekVOTUFzR0ExVUVDZ3dFVDJ0MFlURVUNCk1CSUdBMVVFQ3d3TFUxTlBVSEp2ZG1sa1pYSXhFekFSQmdOVkJBTU1DbVJsZGkwME5UZzBPREV4SERBYUJna3Foa2lHOXcwQkNRRVcNCkRXbHVabTlBYjJ0MFlTNWpiMjB3SGhjTk1UY3dOakUxTURRek5ETTVXaGNOTWpjd05qRTFNRFF6TlRNNVdqQ0JrakVMTUFrR0ExVUUNCkJoTUNWVk14RXpBUkJnTlZCQWdNQ2tOaGJHbG1iM0p1YVdFeEZqQVVCZ05WQkFjTURWTmhiaUJHY21GdVkybHpZMjh4RFRBTEJnTlYNCkJBb01CRTlyZEdFeEZEQVNCZ05WQkFzTUMxTlRUMUJ5YjNacFpHVnlNUk13RVFZRFZRUUREQXBrWlhZdE5EVTRORGd4TVJ3d0dnWUoNCktvWklodmNOQVFrQkZnMXBibVp2UUc5cmRHRXVZMjl0TUlJQklqQU5CZ2txaGtpRzl3MEJBUUVGQUFPQ0FROEFNSUlCQ2dLQ0FRRUENCmo3VXRGcUg0cHRwQ2lCWEI5VVBPN3ExdkVZVGNUK3F5WUREMUIvQ2Q1QUxnOTg5dnh1N0dLM09yWUdKdnI1eE5Dc3puNGNldVlVN0MNCjJDM25YM2pGd1RzRW02RFJsc0hLYlE1emRSQnVJdzJsSldNWWNCcEdlN3IrcjF0WWluaUh3S1BvL1lNRjNLN2hCMWdXK0h1bWRXaksNCmJndDhObm1aU2pwbkhtb0VPUHVYQmNqcTRPSm53bDB5bUF1U0c3dytETTJHN2JybHJ1aVlCYjE2OWl2d2VjeStqZU43WFp2SlZNOTMNCnNwRUpXQU1iMUJvTmhJZDhmaGhnR1JmbGxHOGI2Rk84UWJDbTR1UVh2SlFuMGRGeHlsdnBpM25SYWl6ZWN3TE5ya0tKdVVMMnZqWDENCnV1RzV0NEFMcmRyZ3pxODBnUlhlODRDLzhlQ2l0N0NoM3d0Zm9RSURBUUFCTUEwR0NTcUdTSWIzRFFFQkN3VUFBNElCQVFCL1hNSXcNCjhKL2dLYm5xQ0hXVDgrbkZ2YVQ1cWFlNk9OYjNMWStzVlFvMDRoUlRrYkxnWmhoTjIrdjFXV1N1RDBaMnFRVmpFaWVzVzVtaFZLaEkNCmNIMGFNVEJNbVpqZDRBQkVHdzgvTmRSN1Y4eFNXMVFCc0M1T2x2Q25JTEJMUUwveU5PQWhvZXYrbnRZdnpkaURLR3BnZ1NuOG00SjANCjB1b1d1L3F5bGlrSDgxdzlLV2EycjJ1QlRqSC9tYVd2UHhYYU1naFlTd2sydWpFaHFhbTVVVnNtVmpKaSt1SHFXMlBLZ2liaXNMWlYNCkhDMCtIeC9iRkFZM24yQUg5Zms5dFFXVkl4RndGUnVGWERlTU5RQTR0NXFNeVdtcVBVWEZTU2p2Y0dTODFFempFMElwajNHY2VKUmcNCmVtQTNiaHZWekxZSmVWU0l6NWRiSk5MWFU4YURUYmt5DQotLS0tLUVORCBDRVJUSUZJQ0FURS0tLS0tCg==
  - name: component.dex.saml.usernameAttr
    default: name
  - name: component.dex.saml.emailAttr
    default: email
  - name: component.dex.saml.groupsAttr
    default: groups
  - name: cloud.region
    kind: user
    env: AWS_REGION
  - name: dns.domain
    brief: DNS domain
    kind: tech
    env: DOMAIN_NAME
  - name: dns.name
    default: default
    env: TF_VAR_name

templates:
  files:
    - "*.template"
    - "templates/*.template"
  extra:
  - kind: mustache
    files: ["gencert.sh.template"]
