---
version: 1
kind: component
meta:
  name: postgresql-rds
  brief: PostgreSQL RDS instance with Terraform
  source:
    dir: ../../components/postgresql-rds

parameters:
- name: dns.domain
  env: DOMAIN_NAME
- name: cloud.region
  env: AWS_DEFAULT_REGION
- name: cloud.vpc.id
  env: TF_VAR_vpc_id
- name: component.postgresql
  parameters:
  - name: name
    brief: Component name
    value: postgresql-rds
    env: COMPONENT_NAME
  - name: rds.name
    kind: user
    brief: RDS database instance name
    value: ${dns.name}
    env: TF_VAR_rds_name
  - name: database
    value: agilestacks
    env: TF_VAR_database_name
  - name: user
    value: postgres
    env: TF_VAR_database_username
  - name: password
    env: TF_VAR_database_password
  - name: rds.instanceType
    value: db.t2.micro
    env: TF_VAR_instance_type
  - name: rds.version
    value: "9.6.8"
    env: TF_VAR_engine_version
  - name: rds.snapshot
    empty: allow
    env: TF_VAR_snapshot_identifier
  - name: rds.skipSnapshot
    value: true
    env: TF_VAR_skip_final_snapshot
- name: terraform.bucket.name
  env: STATE_BUCKET
- name: terraform.bucket.region
  env: STATE_REGION

outputs:
- name: component.postgresql.host
  fromTfVar: hostname
- name: component.postgresql.port
  fromTfVar: port
- name: component.postgresql.user
  fromTfVar: username
