---
version: 1
kind: component
meta:
  name: jenkins
  brief: Jenkins CI Server
  source:
    dir: ../../components/jenkins

requires:
  - kubernetes

parameters:
- name: terraform.bucket.name
- name: terraform.bucket.region
- name: component.ingress
  parameters:
  - name: fqdn
  - name: protocol
    default: http
- name: component.jenkins
  parameters:
  - name: namespace
    default: jenkins
    env: NAMESPACE
  - name: image
    default: docker.io/agilestacks/jenkins:2.89.3
  - name: admin.user
    default: admin
  - name: admin.password
    default: secret
  - name: serviceaccount.user
    default: robot
  - name: serviceaccount.password
    default: supersecret
  - name: wait.timeout
    default: 300
    env: TIMEOUT
- name: cloud.region
  kind: user
  env: AWS_REGION
- name: dns.name
- name: dns.baseDomain
- name: dns.domain
  brief: DNS domain
  env: DOMAIN_NAME
- name: nfs.server
  brief: NFS server for NFS volumes

outputs:
- name:  component.jenkins.serviceaccount.user
  value: ${component.jenkins.serviceaccount.user}
- name:  component.jenkins.serviceaccount.password
  value: ${component.jenkins.serviceaccount.password}
- name:  component.jenkins.internal.host
  value: jenkins.${component.jenkins.namespace}.svc.cluster.local
- name:  component.jenkins.internal.port
  value: 8080
- name:  component.jenkins.internal.url
  value: http://jenkins.${component.jenkins.namespace}.svc.cluster.local:8080
- name:  component.jenkins.fqdn
  value: ${component.jenkins.namespace}.${component.ingress.fqdn}

templates:
  files:
    - "*.template"
