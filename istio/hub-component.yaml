---
version: 1
kind: component
meta:
  name: istio
  brief: An open platform to connect, manage, and secure microservices
  source:
      dir: ../../components/istio

requires:
  - kubernetes
  - helm
  - tiller

provides:
  - istio

parameters:
  - name: dns.domain
    env: DOMAIN_NAME
  - name: component.ingress.protocol
  - name: component.ingress.fqdn
  - name: component.ingress.ssoFqdn
  - name: component.istio
    parameters:
    - name: namespace
      value: istio-system
      env: NAMESPACE
    - name: version.release
      value: 1.3.0-rc.0
      env: ISTIO_VERSION
    - name: version.repository
      value: gcr.io/istio-release
     #value: docker.io/istio
    - name: version.image
      value: release-1.3-latest-daily
    - name: tracing.enabled
      value: false
    - name: prometheus.enabled
      value: true
    - name: grafana.enabled
      value: false
    - name: certmanager.enabled
      value: false
    - name: kiali
      parameters:
      - name: enabled
        value: true
      - name: urlPrefix
        value: istio-kiali
      - name: auth.strategy
        value: anonymous
      - name: version.image
        value: latest
      - name: createDemoSecret
        value: '#{component.istio.kiali.auth.strategy == "login" ? "true" : "false"}'

outputs:
  - name: component.istio.kiali.url
    brief: Istio Service Graph
    value: ${component.ingress.protocol}://${component.istio.kiali.urlPrefix}.${component.ingress.ssoFqdn}

templates:
  files:
    - "*.template"
