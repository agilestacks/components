---
version: 1
kind: component
meta:
  name: harbor
  brief: Private Docker Registry
  source:
    dir: ../../components/harbor

requires:
  - kubernetes
provides:
  - harbor

parameters:
- name: dns.domain
  env: TF_VAR_domain
- name: cloud.region
  kind: user
  env: AWS_DEFAULT_REGION
- name: cloud.kind
  env: CLOUD_KIND
- name: component.tls.kind
  value: letsencrypt
  env: TLS_KIND
  empty: allow

- name: component.s3
  parameters:
  - name: bucket
    empty: allow
  - name: region
    empty: allow
  - name: endpoint
    empty: allow
- name: component.minio
  parameters:
  - name: region
    empty: allow
  - name: accessKey
    empty: allow
  - name: secretKey
    empty: allow
  - name: default.bucket.name
    value: default
- name: component.bucket.endpoint
  empty: allow

- name: component.ingress
  parameters:
  - name: fqdn
    env:  INGRESS_FQDN
  - name: staticIp
    env: TF_VAR_ingress_static_ip
    empty: allow
  - name: protocol
- name: component.acm.certificateArn
  empty: allow
- name: terraform.bucket.region
  env: STATE_REGION
- name: terraform.bucket.name
  env: STATE_BUCKET
- name: component.harbor
  parameters:
  - name: storage
    env: STORAGE_KIND
    value: local
  - name: name
    value: ${dns.name}-${hub.componentName}
    env: COMPONENT_NAME
  - name: namespace
    value: harbor
    env: NAMESPACE
  - name: user
    value: admin
    env: ADMIN_USERNAME
  - name: password
    env: ADMIN_PASSWORD
  - name: storageClass
    value: harbor-storage-class
- name: component.cert-manager
  parameters:
  - name: issuer-email
    value: admin@superhub.io
    env: EMAIL

outputs:
- name: component.harbor.pullSecret
  brief: Name of the pull secret to access harbor
  fromTfVar: pull_secret
- name: component.harbor.url
  brief: Harbor URL
  fromTfVar: harbor_fqdn

templates:
  files:
  - "aws/*.template" 
  - "aws/acm/*.template"
  - "aws/letsencrypt/*.template"
  - "aws/local/*.template"
  - "aws/minio/*.template"
  - "aws/minio/*.template"  
  - "aws/s3/*.template"
  - "aws/s3/*.template"
  - "hybrid/local/*.template"
  - "hybrid/minio/*.template"
