---
version: 1
kind: component
meta:
  name: harbor
  brief: Private Docker Registry
  source:
    dir: ../../components/harbor

requires:
  - kubernetes
provides:
  - harbor

parameters:
- name: dns.domain
  env: TF_VAR_domain
- name: cloud.region
  kind: user
  env: AWS_DEFAULT_REGION
- name: cloud.kind
  env: CLOUD_KIND
- name: component.s3
  parameters: 
  - name: bucket
    empty: allow
  - name: region
    empty: allow
  - name: endpoint
    empty: allow
- name: component.acm.certificateArn
  empty: allow
- name: terraform.bucket.region
  env: STATE_REGION
- name: terraform.bucket.name
  env: STATE_BUCKET  
- name: component.harbor
  parameters:
  - name: name
    value: harbor
    env: TF_VAR_component
  - name: namespace
    value: harbor
    env: TF_VAR_namespace
  - name: servicePrefix
    value: svc
    env: TF_VAR_service_prefix
  - name: password
    value: Harbor12345
    env: TF_VAR_harbor_password
  - name: user
    value: admin
    env: TF_VAR_username
  - name: password
    value: Harbor12345
    env: TF_VAR_password
  - name: nginx.image.repository  
    value: quay.io/kubernetes-ingress-controller/nginx-ingress-controller
  - name: nginx.version
    value: 0.12.0

outputs:
- name: component.harbor.pullSecret
  fromTfVar: pull_secret
- name: component.harbor.url
  brief: Harbor URL
  value: https://${component.harbor.name}.${component.harbor.servicePrefix}.${dns.domain} 

templates:
  files:
  - "*.template"
