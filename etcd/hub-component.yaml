---
version: 1
kind: component
meta:
  name: etcd
  brief: etcd distributed storage
  source:
      dir: ../../components/etcd

requires:
  - kubernetes
  - helm
  - tiller
provides:
  - etcd

parameters:
  - name: cloud.bucket
    env:  CLOUD_BUCKET
  - name: dns.domain
    env: DOMAIN_NAME
  - name: component.etcd
    parameters:
    - name:    name
      default: etcd-cluster
      env:     COMPONENT_NAME
    - name:    version
      brief:   etcd-operator version
      default: v0.9.0
    - name:    namespace
      brief: Kubernetes namespace to install into
      default: etcd-cluster
      env:     NAMESPACE
    - name: cluster.enabled
      brief: Start etcd cluster
      default: false
      env:     CLUSTER_ENABLED
    - name: cluster.size
      default: 3
    - name:    cluster.version
      brief:   etcd version
      default: v3.2.16
    - name:    backup.enabled
      brief:   Enable backups
      default: false
      env:     BACKUP_ENABLED
    - name:    restore.enabled
      brief:   Enable restore
      default: false
      env:     RESTORE_ENABLED
    - name:    cluster.s3bucket
      brief: Name of the S3 backup backet
      default: terraform.agilestacks.com
    - name:    cluster.awssecret
      default: awsetcd
    - name:    cluster.backupInterval
      default: 7200
    - name:    cluster.maxBackups
      default: 24

outputs:
  - name: component.etcd.url
    value: http://${component.etcd.name}-client.${component.etcd.namespace}.svc.cluster.local:2379

templates:
  files:
    - "*.template"
