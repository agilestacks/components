---
version: 1
kind: component
meta:
  name: etcd
  brief: etcd distributed storage
  source:
      dir: ../../components/etcd

requires:
  - kubernetes
  - helm
  - tiller
provides:
  - etcd

parameters:
  - name: cloud.region
    env:  AWS_DEFAULT_REGION
  - name: cloud.bucket
    env:  CLOUD_BUCKET
  - name: dns.domain
    env:  DOMAIN_NAME
  - name: component.etcd
    parameters:
    - name:  name
      value: etcd-cluster
      env:   COMPONENT_NAME
    - name:  version
      brief: etcd-operator version
      value: v0.9.0
    - name:  namespace
      brief: Kubernetes namespace to install into
      value: etcd-cluster
      env:   NAMESPACE
    - name:  cluster.enabled
      brief: Start etcd cluster
      value: false
      env:   CLUSTER_ENABLED
    - name:  cluster.size
      value: 3
    - name:  cluster.version
      brief: etcd version
      value: v3.2.16
    - name:  backup.enabled
      brief: Enable backups
      value: false
      env:   BACKUP_ENABLED
    - name:  restore.enabled
      brief: Enable restore
      value: false
      env:   RESTORE_ENABLED
    - name:  cluster.s3bucket
      brief: Name of the S3 backup bucket
      value: terraform.agilestacks.com
    - name:  cluster.awssecret
      value: awsetcd
      env:   AWS_SECRET_NAME
    - name:  cluster.backupInterval
      value: 7200
    - name:  cluster.maxBackups
      value: 24

outputs:
  - name: component.etcd.url
    value: http://${component.etcd.name}-client.${component.etcd.namespace}.svc.cluster.local:2379

templates:
  files:
    - "*.template"
