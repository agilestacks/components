---
version: 1
kind: component
meta:
  name: postgresql
  brief: PostgreSQL
  source:
      dir: ../../components/postgresql

requires:
  - kubernetes
provides:
  - postgresql

parameters:
  - name: dns.domain
    brief: DNS domain
    kind: tech
    env: DOMAIN_NAME
  - name: component.postgresql
    parameters:
    - name:    name
      default: postgresql
      env:     COMPONENT_NAME
    - name:    namespace
      default: postgresql
      env:     NAMESPACE
    - name:    user
    - name:    password
    - name:    database
    - name:    volume
      default: 8Gi
    - name:    port
      default: 5432

outputs:
- name: component.postgresql.host
  value: ${component.postgresql.name}-postgresql.${component.postgresql.namespace}.svc.cluster.local
- name: component.postgresql.port
  value: ${component.postgresql.port}
- name: component.postgresql.user
  value: ${component.postgresql.user}
- name: component.postgresql.url
  brief: PostgreSQL URL
  fromTfVar: database_url

templates:
  files:
    - "*.template"
