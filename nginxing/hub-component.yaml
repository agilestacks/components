---
version: 1
kind: component
meta:
  name: nginxing
  brief: Nginx ingress Controller
  source:
      dir: ../../components/nginxing

requires:
  - kubernetes
  - helm
  - tiller
provides:
  - nginxing

parameters:
  - name: component.wowza.namespace
  - name: component.wowza.name
  - name: dns.domain
    brief: DNS domain
    kind: tech
    env: DOMAIN_NAME
  - name: component.nginxing
    parameters:
    - name:    name
      default: nginxing
      env:     COMPONENT_NAME
    - name:    version
      brief:   nginx-ingress version
      default: "0.11.0"
    - name:    image.repository
      default: quay.io/kubernetes-ingress-controller/nginx-ingress-controller
    - name:    image.pullPolicy
      default: IfNotPresent
    - name:    replicaCount
      default: 1
    - name:    urlPrefix
      default: svc
      env:     URL_PREFIX
    - name:    namespace
      default: nginx-ingress
      env:     NAMESPACE

outputs:
- name: component.nginxing.fqdn
  brief: FQDN of ingress
  fromTfVar: ingress_fqdn

templates:
  extra:
  - kind: mustache
    files: ["deploy-aws.sh.template", "undeploy-aws.sh.template"]
  - kind: curly
    files: ["values.yaml.template"]
