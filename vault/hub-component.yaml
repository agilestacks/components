---
version: 1
kind: component
meta:
  name: vault
  brief: Vault a tool for managing secrets
  source:
      dir: ../../components/vault

#requires:
 # - kubernetes
#provides:
#  - vault


parameters:
  - name: dns.domain
    brief: DNS domain
    kind: tech
    env: DOMAIN_NAME
  - name: component.ingress.fqdn
  - name: component.vault
    parameters:
    - name:    name
      default: vault-service
      env:     COMPONENT_NAME
    - name:    version
      brief:   vault version
      default: 0.7.3
    - name:    image.repository
      default: vault
    - name:    image.pullPolicy
      default: IfNotPresent
    - name:    replicaCount
      default: 1
    - name:    resources.limits.memory
      default: "128Mi"
    - name:    namespace
      brief: Kubernetes namespace to install into
      default: vault
      env:     NAMESPACE
    - name: port
      brief: Port to listen on
      default: 8200
    - name: ingress.enabled
      brief: Deploy ingress for vault
      env:     INGRESS_ENABLED
      default: false
    - name: ipaddress
      default: "0.0.0.0"
    - name: tls.disabled
      default: 1
    - name: etcd.api
      default: "v3"
  - name: component.etcd
    parameters:
      - name: name
      - name: namespace

outputs:
- name: component.vault.url
  fromTfVar: vault_url
- name: component.vault.token.root
  fromTfVar: Initial_Root_Token
- name: component.vault.key.unseal1
  fromTfVar: Unseal_Key_1
- name: component.vault.key.unseal2
  fromTfVar: Unseal_Key_2
- name: component.vault.key.unseal3
  fromTfVar: Unseal_Key_3
- name: component.vault.key.unseal4
  fromTfVar: Unseal_Key_4
- name: component.vault.key.unseal5
  fromTfVar: Unseal_Key_5

templates:
  files:
    - "*.template"
