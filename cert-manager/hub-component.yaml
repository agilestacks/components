---
version: 1
kind: component
meta:
  name: cert-manager
  brief: Automate the management and issuance of TLS certificates
  source:
    dir: ../../components/cert-manager

requires:
- kubernetes
provides:
- cert-manager

parameters:
- name: cloud.region # for DNS01 ACME solver
  value: us-east-1
- name: dns.domain
  env: DOMAIN_NAME
- name: kubernetes.flavor
  empty: allow
  env: KUBE_FLAVOR
- name: component.cert-manager
  parameters:
  - name: name
    value: cert-manager
    env: COMPONENT_NAME
  - name: namespace
    value: cert-manager
    env: NAMESPACE
  - name: issuerEmail
    value: admin@superhub.io
  - name: defaultIssuerName
    value: letsencrypt-prod
   #value: letsencrypt-staging
   #value: ca-issuer
  - name: defaultIssuerKind
    value: ClusterIssuer
   #value: Issuer
  - name: caIssuer
    empty: allow
    parameters:
    - name: name
      value: ca-issuer
    - name: key
    - name: certificate
# alias for CEL expression
- name: certmanager.caIssuer.key
  value: ${component.cert-manager.caIssuer.key}
- name: component.cert-manager.caIssuer.enabled
  value: '#{size(certmanager.caIssuer.key) > 1}'
  env: CA_ISSUER_ENABLED

outputs:
- name: component.tls.kind
  value: letsencrypt

templates:
  files:
  - "*.template"
