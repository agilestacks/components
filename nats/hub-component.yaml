---
version: 1
kind: component
meta:
  name: nats
  brief: NATS messaging system
  source:
    dir: ../../components/nats

requires:
  - kubernetes
  - ingress
provides:
  - nats

parameters:
- name: dns.domain
  env: DOMAIN_NAME
- name: component.ingress.protocol
- name: component.ingress.ssoFqdn
- name: component.nats
  parameters:
  - name: name
    value: nats-${dns.name}-${hub.componentName}
    env: COMPONENT_NAME
  - name: namespace
    # primary consumer is argo
    value: argoproj
    env: NAMESPACE
  - name: port
    value: 4222
  - name: monitor.port
    value: 8222
  - name: replicas
    value: 1
  - name: chart.version
    value: '2.0.1'
    # value: '0.1.1'
    env: CHART_VERSION
  - name: natsboard.image
    value: agilestacks/natsboard:latest
    # value: urashidmalik/natsboard:latest
outputs:
- name:  component.nats.client.fqdn
  value: ${component.nats.name}-nats-client.${component.nats.namespace}.svc.cluster.local:${component.nats.port}
- name:  component.nats.fqdn
  value: ${component.nats.client.fqdn}
- name:  component.nats.monitor.fqdn
  value: ${component.nats.name}-nats-monitoring.${component.nats.namespace}.svc.cluster.local:${component.nats.monitor.port}
- name:  component.nats.monitor.ingress
  value: ${component.nats.name}.${component.ingress.ssoFqdn}
- name:  component.nats.monitor.url
  value: ${component.ingress.protocol}://${component.nats.monitor.ingress}
templates:
  files:
  - "*.template"
  - "natsboard/*.template"
