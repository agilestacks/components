---
version: 1
kind: component
meta:
  name: nginx
  brief: Nginx ingress Controller
  source:
      dir: ../../components/nginx

requires:
  - kubernetes
provides:
  - ingress

parameters:
  - name: dns.domain
    brief: DNS domain
    kind: tech
    env: DOMAIN_NAME
  - name: kubernetes.oidc_issuer_fqdn
    kind: user
    env: OIDC_ISSUER_FQDN
  - name: component.ingress
    parameters:
    - name:    name
      default: nginx
      env:     COMPONENT_NAME
    - name:    version
      brief:   nginx-ingress version
      default: "0.9.0-beta.11"
    - name:    image.repository
      default: gcr.io/google_containers/nginx-ingress-controller
    - name:    image.pullPolicy
      default: IfNotPresent
    - name:    replicaCount
      default: 1
    - name:    urlPrefix
      default: www
      env:     URL_PREFIX
    - name:    namespace
      default: nginx-ingress
      env:     NAMESPACE

outputs:
- name: component.ingress.fqdn
  brief: FQDN of ingress
  fromTfVar: ingress_fqdn

templates:
  extra:
  - kind: mustache
    files: ["deploy-aws.sh.template", "undeploy-aws.sh.template"]
  - kind: curly
    files: ["values.yaml.template"]