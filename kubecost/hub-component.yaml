---
version: 1
kind: component
meta:
  name: kubecost
  title: Kubecost
  brief: Kubernetes recource managment
  description: >
    Kubecost gives you visibility into your Kubernetes resources to reduce spend and prevent resource-based outages.
  category: Kubernetes Tools
  version: 1.59.0
  maturity: alpha
  keywords:
    - aws
  source:
    dir: ../../components/kubecost

requires:
  - kubernetes
  - helm
provides:
  - kubecost

parameters:
  - name: dns.domain
    env: DOMAIN_NAME
  - name: terraform.bucket.name
    env:  STATE_BUCKET
  - name: terraform.bucket.region
    env:  STATE_REGION
  - name: component.ingress.protocol
  - name: component.ingress.ssoFqdn
  - name: component.ingress.kubernetes.ingressClass
    empty: allow
  - name: component.kubecost
    parameters:
    - name: name
      value: kubecost-${dns.name}-${hub.componentName}
      env: COMPONENT_NAME
    - name: service.port
      value: 9090
    - name: ingress.urlPrefix
      value: kubecost-${dns.name}-${hub.componentName}
    - name: ingress.path
      value: /
    - name: spotData.bucket.name
      value: ${terraform.bucket.name}
      env: TF_VAR_spot_data_bucket
    - name: spotData.bucket.region
      value: ${terraform.bucket.region}
      env: TF_VAR_spot_data_bucket_region
    - name: spotData.prefix
      value: ${dns.domain}/kubecost/${component.kubecost.name}/spot-data-feed
      env: TF_VAR_spot_data_prefix
    - name: token
      empty: allow
      env: KUBECOST_TOKEN
    - name: namespace
      value: kubecost
      env: NAMESPACE
    - name: version
      value: v1.59.0
      env: VERSION


outputs:
  - name: component.kubecost.url
    value: ${component.ingress.protocol}://${component.kubecost.ingress.urlPrefix}.${component.ingress.ssoFqdn}/overview.html



templates:
  files:
  - "*.template"
